## 用户手册

### 软件信息

* 版本：2.0
* 作者：lh9171338
* 日期：2022-02-20

### 快捷键（默认）

* Ctrl + O：打开图像文件夹
* Ctrl + S：保存标注结果
* Ctrl + V：进入下一张图像
* Ctrl + B：返回上一张图像
* Ctrl + C：进入线段标注状态
* Ctrl + D：删除选中的线段标注
* Ctrl + U：查看用户手册

**注**：编辑`default.yaml`文件可以修改快捷键

### 鼠标按键

* 左键：标注一个线段端点
* 右键：进入或退出线段标注状态

### 操作流程

1. 选择一个待标注图像所在的文件夹
2. 单击鼠标右键（或通过`Ctrl + C`快捷键）进入线段标注状态
3. 通过鼠标左键选择线段标注点，最少选择2个标注点
4. 标注点选择完毕后，再次点击鼠标右键退出线段标注状态，至此一条线段标注完成，中途可以单击鼠标右键（或通过`Ctrl + C`快捷键）退出线段标注状态
5. 重复步骤2-4，中途最好多次保存标注结果，以防程序意外崩溃

### 标注原理

鱼眼图像中的线段可以用圆锥曲线描述，公式如下，可以通过至少5个线段标注点进行参数求解
$$A x^2 + 2 B x y + C y^2 + 2 D x + 2 E y + F = 0$$
当线段为直线段时，公式退化为如下形式，可以通过至少2个线段标注点进行参数求解
$$2 D x + 2 E y + F = 0$$

因此，当标注点数量 $n ≥ 5$ 时，当作圆锥曲线进行求解；否则当作直线段进行求解

**注**：对于所有的标注线段，尽管标注时标注点数量可以不同，但是保存时会被插值为相同的点数`n_pts`，`n_pts`的值在`default.yaml`文件中配置

### 数据集文件结构

    |-- dataset   
        |-- <image folder>
            |-- 000001.png  
            |-- 000002.png  
            |-- ...  
        |-- <label folder>  
            |-- 000001.mat  
            |-- 000002.mat  
            |-- ...

**注**：`<image folder>`和`<label folder>`路径在`default.yaml`文件中配置，二者可以相同

### 程序运行

```shell
python Labelline.py
```
